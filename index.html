<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Real-time Analytics</title>
  <style>
    :root{ --bg:#0b1020;--card:#121933cc;--accent:#6ee7ff;--accent2:#a78bfa;--ok:#10b981;--bad:#ef4444;--muted:#9aa3b2;--grid:#1e2749; }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent}
    html{height:100%; font-size:16px}
    body{ min-height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial; color:#e6e9ef;
      background: radial-gradient(1000px 600px at 10% -10%, #1b2455, transparent),
                  radial-gradient(900px 600px at 110% 20%, #1b3a5a, transparent),
                  linear-gradient(180deg,#0b1020,#0a0f1d 60%);} 
    button,input,textarea{-webkit-appearance:none;appearance:none;background-color:#0d1328}
    select{-webkit-appearance:menulist;appearance:menulist;background-color:#0d1328;color:#e6e9ef}
    select option{background-color:#0d1328;color:#e6e9ef}

    .container{max-width:980px;margin:40px auto;padding:0 20px}
    .card{position:relative;background:var(--card);backdrop-filter:blur(8px);border:1px solid #2a3357;border-radius:20px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
    h1{font-size:clamp(20px,5vw,34px);margin:0}
    .lang-select{min-width:220px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .field{grid-column:span 12}
    @media (min-width:800px){.field.sm-6{grid-column:span 6}.field.sm-4{grid-column:span 4}.field.sm-3{grid-column:span 3}}
    label{display:block;font-size:14px;color:#c6cce0;margin:0 0 8px}
    select,button{width:100%;padding:14px 16px;border-radius:12px;border:1px solid #2d365f;color:#e6e9ef;font-size:16px;min-height:48px}
    select:focus,button:focus{outline:2px solid #2aa9ff33}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{cursor:pointer;transition:.18s transform ease,.18s background-color ease;font-weight:600}
    .btn:hover{transform:translateY(-1px)}.btn:active{transform:none}.btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:0;color:#04121a}
    .btn-outline{background:transparent}

    .result{margin-top:20px;padding:18px;border-radius:16px;border:1px solid #33406d;background:#0e152f}
    .badge{display:inline-flex;align-items:center;gap:8px;font-weight:800;padding:8px 14px;border-radius:999px;letter-spacing:.3px}
    .buy{background:#0e2e1f;color:#7ef2b3;border:1px solid #1d5e41;animation:glowUp 1.6s ease-in-out infinite}
    .sell{background:#2e1313;color:#ff9ea1;border:1px solid #6e2326;animation:glowDown 1.6s ease-in-out infinite}
    @keyframes glowUp{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,.0)}50%{box-shadow:0 0 30px 4px rgba(16,185,129,.35)}}
    @keyframes glowDown{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.0)}50%{box-shadow:0 0 30px 4px rgba(239,68,68,.35)}}
    .meta{color:#a9b0c3;font-size:14px}
    .just{margin:12px 0 0;line-height:1.55}

    .chart-wrap{margin-top:16px}
    .chart{position:relative;height:220px;border:1px solid #2a3357;border-radius:14px;background:
      linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.0)),
      repeating-linear-gradient(0deg, transparent, transparent 28px, rgba(255,255,255,.05) 28px, rgba(255,255,255,.05) 29px),
      #0b122a;overflow:hidden}
    .chart canvas{position:absolute;inset:0;width:100%;height:100%}
    .trend-label{position:absolute;inset:auto 12px 12px auto;padding:6px 10px;font-size:12px;border-radius:999px;background:#0d1328;border:1px solid #2a3357;color:#c8d0e5;opacity:.9}

    .overlay{position:absolute;inset:0;background:rgba(9,13,28,.72);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(6px);z-index:100}
    .overlay[hidden]{display:none}
    .loader{display:flex;flex-direction:column;align-items:center;gap:10px}
    .spinner{width:52px;height:52px;border-radius:50%;border:3px solid rgba(255,255,255,.15);border-top-color:var(--accent);animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{font-weight:800;letter-spacing:2px;opacity:.95}

    @media (max-width:600px){
      .container{margin:16px auto;padding:0 12px}
      .card{padding:16px;border-radius:16px}
      .grid{gap:12px}
      .sticky-actions{
        position: sticky; bottom:0; left:0; right:0; padding:12px; margin-top:8px; border-top:1px solid #2a3357; 
        background: linear-gradient(180deg, rgba(13,19,40,0.0), rgba(13,19,40,0.35) 10%, rgba(13,19,40,0.85));
        backdrop-filter: blur(6px);
        padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
        border-bottom-left-radius:12px; border-bottom-right-radius:12px;
      }
      .mobile-stack>*{flex:1 1 100%}
      .lang-select{min-width:unset;width:100%}
      .topbar{flex-direction:column;align-items:flex-start}
    }
    @media (prefers-reduced-motion:reduce){.btn{transition:none}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="topbar">
        <h1 id="title">Real-time Analytics</h1>
        <select id="lang" class="lang-select" aria-label="Language">
          <option value="en" selected>üá∫üá∏ English</option>
          <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
          <option value="es">üá™üá∏ Espa√±ol</option>
          <option value="fr">üá´üá∑ Fran√ßais</option>
          <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        </select>
      </div>

      <div class="grid" id="controls">
        <div class="field sm-4">
          <label for="broker" id="lbl-broker">Broker</label>
          <select id="broker">
            <option value="Pocket Option" selected>Pocket Option</option>
            <option value="IQ Option">IQ Option</option>
            <option value="Binomo">Binomo</option>
            <option value="Bubinga">Bubinga</option>
            <option value="Quotex">Quotex</option>
          </select>
        </div>
        <div class="field sm-4">
          <label for="pair" id="lbl-pair">Currency Pair (OTC)</label>
          <select id="pair">
            <option value="EUR/USD" selected>EUR/USD (OTC)</option>
            <option value="GBP/USD">GBP/USD (OTC)</option>
            <option value="USD/JPY">USD/JPY (OTC)</option>
            <option value="USD/CHF">USD/CHF (OTC)</option>
            <option value="AUD/USD">AUD/USD (OTC)</option>
            <option value="BTC/USD">BTC/USD (OTC)</option>
          </select>
        </div>
        <div class="field sm-4">
          <label for="tf" id="lbl-tf">Timeframe</label>
          <select id="tf">
            <option value="15s">15s</option>
            <option value="30s" selected>30s</option>
            <option value="1m">1m</option>
            <option value="2m">2m</option>
            <option value="5m">5m</option>
          </select>
        </div>
        <div class="field sm-3">
          <label for="indicator" id="lbl-ind">Indicator for Rationale</label>
          <select id="indicator">
            <option value="AUTO" selected>Auto (random)</option>
            <option value="MACD">MACD</option>
            <option value="STOCH">Stochastic</option>
            <option value="RSI">RSI</option>
            <option value="WILL">Williams %R</option>
            <option value="BBAN">Bollinger Bands</option>
          </select>
        </div>
        <div class="field sm-6" style="align-self:end">
          <div class="row sticky-actions mobile-stack">
            <button id="start" class="btn btn-primary">Start</button>
            <button id="again" class="btn btn-outline" disabled>Get new signal</button>
          </div>
        </div>
      </div>

      <div id="out"></div>

      <div class="chart-wrap">
        <div class="chart" id="chart">
          <canvas id="c"></canvas>
          <div class="trend-label" id="trendLabel">‚Äî</div>
        </div>
      </div>

      <!-- Loading overlay -->
      <div class="overlay" id="loading" hidden aria-live="polite" aria-busy="true">
        <div class="loader">
          <div class="spinner"></div>
          <div class="loading-text" id="loadingText">–ê–ù–ê–õ–ò–ó–ò–†–£–Æ</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    document.addEventListener('touchstart', function(){}, {passive:true}); // iOS/Telegram fix

    /* ===== I18N ===== */
    var I18N = {
      en:{flag:'üá∫üá∏',name:'English',locale:'en-US',dir:'ltr',title:'Real-time Analytics',
        labels:{broker:'Broker',pair:'Currency Pair (OTC)',tf:'Timeframe',ind:'Indicator for Rationale'},
        buttons:{start:'Start',again:'Get new signal'},
        indNames:{AUTO:'Auto (random)',MACD:'MACD',STOCH:'Stochastic',RSI:'RSI',WILL:'Williams %R',BBAN:'Bollinger Bands'},
        result:{buy:'BUY',sell:'SELL',indicator:'Indicator',reason:'Rationale',nextIn:'Next update in',ready:'Ready'},
        loading:'ANALYZING',
        ph:{bull:'bullish',bear:'bearish',high:'local high',low:'local low',
          sto:{overb:'overbought',overs:'oversold',mid:'mid-range',cross:'signal cross',div:'divergence vs price',exit:'exit from zone'},
          rsi:{overb:'overbought',overs:'oversold',bal:'balance',r50:'bounce from 50',hdiv:'hidden divergence',brk:'break of local level'},
          will:{overb:'overbought',overs:'oversold',neutral:'neutral zone',exit:'exit from extreme zone',post:'signal after consolidation',ret:'retest of level'},
          bban:{upper:'upper',middle:'middle',lower:'lower',squeeze:'squeeze ‚Üí possible impulse',bounce:'bounce from band',brk:'breakout and hold'}
      }},
      ru:{flag:'üá∑üá∫',name:'–†—É—Å—Å–∫–∏–π',locale:'ru-RU',dir:'ltr',title:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏',
        labels:{broker:'–ë—Ä–æ–∫–µ—Ä',pair:'–í–∞–ª—é—Ç–Ω–∞—è –ø–∞—Ä–∞ (OTC)',tf:'–¢–∞–π–º—Ñ—Ä–µ–π–º',ind:'–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è'},
        buttons:{start:'–°—Ç–∞—Ä—Ç',again:'–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª'},
        indNames:{AUTO:'–ê–≤—Ç–æ–≤—ã–±–æ—Ä (—Å–ª—É—á–∞–π–Ω—ã–π)',MACD:'MACD',STOCH:'–°—Ç–æ—Ö–∞—Å—Ç–∏–∫',RSI:'RSI',WILL:'Williams %R',BBAN:'–ü–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞'},
        result:{buy:'BUY / –ü–æ–∫—É–ø–∫–∞',sell:'SELL / –ü—Ä–æ–¥–∞–∂–∞',indicator:'–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä',reason:'–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ',nextIn:'–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑',ready:'–ì–æ—Ç–æ–≤–æ'},
        loading:'–ê–ù–ê–õ–ò–ó–ò–†–£–Æ',
        ph:{bull:'–±—ã—á—å–∏–º',bear:'–º–µ–¥–≤–µ–∂—å–∏–º',high:'–º–∞–∫—Å–∏–º—É–º–µ',low:'–º–∏–Ω–∏–º—É–º–µ',
          sto:{overb:'–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏',overs:'–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏',mid:'—Å–µ—Ä–µ–¥–∏–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞',cross:'—Å–∏–≥–Ω–∞–ª—å–Ω—ã–π –∫—Ä–æ—Å—Å',div:'—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å —Ü–µ–Ω–æ–π',exit:'–≤—ã—Ö–æ–¥ –∏–∑ –∑–æ–Ω—ã'},
          rsi:{overb:'–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å',overs:'–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å',bal:'–±–∞–ª–∞–Ω—Å',r50:'–æ—Ç–±–æ–π –æ—Ç —É—Ä–æ–≤–Ω—è 50',hdiv:'—Å–∫—Ä—ã—Ç–∞—è –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è',brk:'–ø—Ä–æ–±–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è'},
          will:{overb:'–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å',overs:'–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å',neutral:'–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞',exit:'–≤—ã—Ö–æ–¥ –∏–∑ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –∑–æ–Ω—ã',post:'—Å–∏–≥–Ω–∞–ª –ø–æ—Å–ª–µ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏',ret:'—Ä–µ—Ç–µ—Å—Ç —É—Ä–æ–≤–Ω—è'},
          bban:{upper:'–≤–µ—Ä—Ö–Ω–µ–π',middle:'—Å—Ä–µ–¥–Ω–µ–π',lower:'–Ω–∏–∂–Ω–µ–π',squeeze:'—Å–∂–∞—Ç–∏–µ ‚Üí –≤–æ–∑–º–æ–∂–µ–Ω –∏–º–ø—É–ª—å—Å',bounce:'–æ—Ç–±–æ–π –æ—Ç –≥—Ä–∞–Ω–∏—Ü—ã',brk:'–ø—Ä–æ–±–æ–π –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ'}
      }},
      es:{flag:'üá™üá∏',name:'Espa√±ol',locale:'es-ES',dir:'ltr',title:'Anal√≠tica en tiempo real',
        labels:{broker:'Br√≥ker',pair:'Par de divisas (OTC)',tf:'Temporalidad',ind:'Indicador para la justificaci√≥n'},
        buttons:{start:'Iniciar',again:'Nueva se√±al'},
        indNames:{AUTO:'Auto (aleatorio)',MACD:'MACD',STOCH:'Estoc√°stico',RSI:'RSI',WILL:'Williams %R',BBAN:'Bandas de Bollinger'},
        result:{buy:'COMPRA',sell:'VENTA',indicator:'Indicador',reason:'Justificaci√≥n',nextIn:'Siguiente en',ready:'Listo'},
        loading:'ANALIZANDO',
        ph:{bull:'alcista',bear:'bajista',high:'m√°ximo local',low:'m√≠nimo local',
          sto:{overb:'sobrecompra',overs:'sobreventa',mid:'zona media',cross:'cruce de se√±al',div:'divergencia con el precio',exit:'salida de la zona'},
          rsi:{overb:'sobrecompra',overs:'sobreventa',bal:'equilibrio',r50:'rebote desde 50',hdiv:'divergencia oculta',brk:'ruptura del nivel local'},
          will:{overb:'sobrecompra',overs:'sobreventa',neutral:'zona neutral',exit:'salida de zona extrema',post:'se√±al tras consolidaci√≥n',ret:'retest del nivel'},
          bban:{upper:'banda superior',middle:'banda media',lower:'banda inferior',squeeze:'compresi√≥n ‚Üí posible impulso',bounce:'rebote en la banda',brk:'ruptura y consolidaci√≥n'}
      }},
      fr:{flag:'üá´üá∑',name:'Fran√ßais',locale:'fr-FR',dir:'ltr',title:'Analyse en temps r√©el',
        labels:{broker:'Courtier',pair:'Paire de devises (OTC)',tf:'Unit√© de temps',ind:'Indicateur pour la justification'},
        buttons:{start:'D√©marrer',again:'Nouveau signal'},
        indNames:{AUTO:'Auto (al√©atoire)',MACD:'MACD',STOCH:'Stochastique',RSI:'RSI',WILL:'Williams %R',BBAN:'Bandes de Bollinger'},
        result:{buy:'ACHAT',sell:'VENTE',indicator:'Indicateur',reason:'Justification',nextIn:'Prochaine mise √† jour dans',ready:'Pr√™t'},
        loading:'ANALYSE',
        ph:{bull:'haussier',bear:'baissier',high:'sommet local',low:'creux local',
          sto:{overb:'surachat',overs:'survente',mid:'zone m√©diane',cross:'croisement de signal',div:'divergence vs prix',exit:'sortie de zone'},
          rsi:{overb:'surachat',overs:'survente',bal:'√©quilibre',r50:'rebond sur 50',hdiv:'divergence cach√©e',brk:'cassure du niveau local'},
          will:{overb:'surachat',overs:'survente',neutral:'zone neutre',exit:'sortie de la zone extr√™me',post:'signal apr√®s consolidation',ret:'retest du niveau'},
          bban:{upper:'bande sup√©rieure',middle:'bande m√©diane',lower:'bande inf√©rieure',squeeze:'resserrement ‚Üí impulsion possible',bounce:'rebond sur la bande',brk:'cassure et consolidation'}
      }},
      ar:{flag:'üá∏üá¶',name:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',locale:'ar-EG',dir:'rtl',title:'ÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ ŸÅŸàÿ±Ÿäÿ©',
        labels:{broker:'ÿßŸÑŸàÿ≥Ÿäÿ∑',pair:'ÿ≤Ÿàÿ¨ ÿßŸÑÿπŸÖŸÑÿßÿ™ (OTC)',tf:'ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≤ŸÖŸÜŸä',ind:'ÿßŸÑŸÖÿ§ÿ¥ÿ± ŸÑŸÑÿ™ÿ®ÿ±Ÿäÿ±'},
        buttons:{start:'ÿ®ÿØÿ°',again:'ÿ•ÿ¥ÿßÿ±ÿ© ÿ¨ÿØŸäÿØÿ©'},
        indNames:{AUTO:'ÿ™ŸÑŸÇÿßÿ¶Ÿä (ÿπÿ¥Ÿàÿßÿ¶Ÿä)',MACD:'MACD',STOCH:'ÿ≥ÿ™ŸàŸÉÿßÿ≥ÿ™ŸäŸÉ',RSI:'RSI',WILL:'Williams %R',BBAN:'ÿ®ŸàŸÑŸÜÿ¨ÿ± ÿ®ÿßŸÜÿØÿ≤'},
        result:{buy:'ÿ¥ÿ±ÿßÿ°',sell:'ÿ®Ÿäÿπ',indicator:'ÿßŸÑŸÖÿ§ÿ¥ÿ±',reason:'ÿßŸÑÿ™ÿ®ÿ±Ÿäÿ±',nextIn:'ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿßŸÑŸä ÿÆŸÑÿßŸÑ',ready:'ÿ¨ÿßŸáÿ≤'},
        loading:'ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ',
        ph:{bull:'ÿ™ŸÇÿßÿ∑ÿπ ÿµÿßÿπÿØ',bear:'ÿ™ŸÇÿßÿ∑ÿπ Ÿáÿßÿ®ÿ∑',high:'ŸÇŸÖÿ© ŸÖÿ≠ŸÑŸäÿ©',low:'ŸÇÿßÿπ ŸÖÿ≠ŸÑŸä',
          sto:{overb:'ÿ™ÿ¥ÿ®ÿπ ÿ¥ÿ±ÿßÿ¶Ÿä',overs:'ÿ™ÿ¥ÿ®ÿπ ÿ®ŸäÿπŸä',mid:'ŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©',cross:'ÿ™ŸÇÿßÿ∑ÿπ ÿ•ÿ¥ÿßÿ±ÿ©',div:'ÿßŸÜÿ≠ÿ±ÿßŸÅ ŸÖÿπ ÿßŸÑÿ≥ÿπÿ±',exit:'ÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©'},
          rsi:{overb:'ÿ™ÿ¥ÿ®ÿπ ÿ¥ÿ±ÿßÿ¶Ÿä',overs:'ÿ™ÿ¥ÿ®ÿπ ÿ®ŸäÿπŸä',bal:'ÿ™Ÿàÿßÿ≤ŸÜ',r50:'ÿßÿ±ÿ™ÿØÿßÿØ ŸÖŸÜ 50',hdiv:'ÿßŸÜÿ≠ÿ±ÿßŸÅ ŸÖÿÆŸÅŸä',brk:'ÿßÿÆÿ™ÿ±ÿßŸÇ ŸÖÿ≥ÿ™ŸàŸâ ŸÖÿ≠ŸÑŸä'},
          will:{overb:'ÿ™ÿ¥ÿ®ÿπ ÿ¥ÿ±ÿßÿ¶Ÿä',overs:'ÿ™ÿ¥ÿ®ÿπ ÿ®ŸäÿπŸä',neutral:'ŸÖŸÜÿ∑ŸÇÿ© ÿ≠ŸäÿßÿØŸäÿ©',exit:'ÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ™ÿ∑ÿ±ŸÅÿ©',post:'ÿ•ÿ¥ÿßÿ±ÿ© ÿ®ÿπÿØ ÿ™ÿ¨ŸÖŸäÿπ',ret:'ÿ•ÿπÿßÿØÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ'},
          bban:{upper:'ÿßŸÑÿ≠ÿßŸÅÿ© ÿßŸÑÿπŸÑŸäÿß',middle:'ÿßŸÑŸàÿ≥ÿ∑Ÿâ',lower:'ÿßŸÑÿ≥ŸÅŸÑŸâ',squeeze:'ÿßŸÜÿ∂ÿ∫ÿßÿ∑ ‚Üí ÿßÿ≠ÿ™ŸÖÿßŸÑ ÿ≠ÿ±ŸÉÿ© ŸÇŸàŸäÿ©',bounce:'ÿßÿ±ÿ™ÿØÿßÿØ ŸÖŸÜ ÿßŸÑÿ≠ÿØ',brk:'ÿßÿÆÿ™ÿ±ÿßŸÇ Ÿàÿ™ÿ£ŸÉŸäÿØ'}
      }}
    };
    var IND_KEYS = ['AUTO','MACD','STOCH','RSI','WILL','BBAN'];

    /* ===== Brokers ===== */
    var BROKERS = {
      'Pocket Option': { pairs:['EUR/USD','GBP/USD','USD/JPY','USD/CHF','AUD/USD','BTC/USD'], tfs:['15s','30s','1m','2m','5m'] },
      'IQ Option':     { pairs:['EUR/USD','GBP/USD','AUD/CAD','USD/CHF','EUR/JPY','GBP/JPY'], tfs:['30s','1m','5m','15m'] },
      'Binomo':        { pairs:['EUR/USD','USD/JPY','GBP/USD','USD/CAD','EUR/GBP'],          tfs:['1m','5m','15m'] },
      'Bubinga':       { pairs:['EUR/USD','GBP/JPY','AUD/JPY','USD/TRY','BTC/USD'],          tfs:['30s','1m','2m','5m'] },
      'Quotex':        { pairs:['EUR/USD','GBP/USD','USD/JPY','EUR/JPY','NZD/USD','BTC/USD'],tfs:['30s','1m','2m','5m','10m'] }
    };

    /* ===== Elements ===== */
    var titleEl = document.getElementById('title');
    var langEl  = document.getElementById('lang');
    var brokerEl = document.getElementById('broker');
    var pairEl   = document.getElementById('pair');
    var tfEl     = document.getElementById('tf');
    var indicatorEl = document.getElementById('indicator');
    var startBtn = document.getElementById('start');
    var againBtn = document.getElementById('again');
    var outEl    = document.getElementById('out');

    var lblBroker = document.getElementById('lbl-broker');
    var lblPair   = document.getElementById('lbl-pair');
    var lblTf     = document.getElementById('lbl-tf');
    var lblInd    = document.getElementById('lbl-ind');

    var chartEl = document.getElementById('chart');
    var canvas = document.getElementById('c');
    var trendLabel = document.getElementById('trendLabel');
    var ctx = canvas.getContext('2d'), raf = null;

    var loadingEl = document.getElementById('loading');
    var loadingTextEl = document.getElementById('loadingText');
    var loadingTimer = null;

    var SIGNAL_CACHE = new Map();  // key -> {side, ind, reason, ts, expiresAt}
    var currentLang = 'en';
    var lastCfg = null, lastSig = null;
    var countdownTimer = null;

    /* ===== Init ===== */
    function initBrokers(){
      brokerEl.innerHTML='';
      var names = Object.keys(BROKERS);
      for(var i=0;i<names.length;i++){
        var name = names[i], opt = document.createElement('option');
        opt.value=name; opt.textContent=name;
        if(i===0) opt.selected=true;
        brokerEl.appendChild(opt);
      }
      if(!brokerEl.options.length){ var o=document.createElement('option'); o.value=''; o.textContent='‚Äî'; brokerEl.appendChild(o); }
      fillByBroker();
    }
    function fillByBroker(){
      var key = brokerEl.value; if(!BROKERS[key]){ key = Object.keys(BROKERS)[0]; brokerEl.value = key; }
      var b = BROKERS[key]; if(!b) return;
      pairEl.innerHTML=''; for(var i=0;i<b.pairs.length;i++){ var p=b.pairs[i]; var o=document.createElement('option'); o.value=p; o.textContent=p+' (OTC)'; if(i===0) o.selected=true; pairEl.appendChild(o); }
      tfEl.innerHTML=''; for(var j=0;j<b.tfs.length;j++){ var t=b.tfs[j]; var o2=document.createElement('option'); o2.value=t; o2.textContent=t; if(j===0) o2.selected=true; tfEl.appendChild(o2); }
      validateReady();
      handleConfigChange();
    }
    function validateReady(){ startBtn.disabled = !(brokerEl.value && pairEl.value && tfEl.value); }
    brokerEl.addEventListener('change', fillByBroker);
    pairEl.addEventListener('change', handleConfigChange);
    tfEl.addEventListener('change', handleConfigChange);

    /* ===== I18N apply ===== */
    function applyLang(lang){
      currentLang = lang; var L = I18N[lang];
      document.documentElement.lang = lang; document.documentElement.dir = L.dir || 'ltr';
      titleEl.textContent = L.title; lblBroker.textContent = L.labels.broker; lblPair.textContent = L.labels.pair; lblTf.textContent = L.labels.tf; lblInd.textContent = L.labels.ind;
      startBtn.textContent = L.buttons.start; againBtn.textContent = L.buttons.again; trendLabel.textContent = '‚Äî';
      var cur = indicatorEl.value || 'AUTO'; indicatorEl.innerHTML='';
      for(var i=0;i<IND_KEYS.length;i++){ var k=IND_KEYS[i], opt=document.createElement('option'); opt.value=k; opt.textContent=L.indNames[k]; if(k===cur) opt.selected=true; indicatorEl.appendChild(opt); }
      if(!loadingEl.hidden){ loadingTextEl.textContent = (L.loading||'ANALYZING').toUpperCase(); }
      if(lastCfg && lastSig){ renderResult(lastCfg, lastSig); if(lastSig.expiresAt && Date.now()<lastSig.expiresAt) startCountdownFor(lastCfg,lastSig); }
    }
    langEl.addEventListener('change', function(e){ applyLang(e.target.value); });

    /* ===== Utils ===== */
    function rnd(min,max){ return Math.random()*(max-min)+min; }
    function rndi(min,max){ return Math.floor(rnd(min,max+1)); }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function biasSide(){ return Math.random()<0.5? 'BUY':'SELL'; }
    function formatTime(d){ var L=I18N[currentLang]; return d.toLocaleString(L.locale||'en-US',{hour12:false}); }
    function tfToMs(tf){ if(!tf) return 60000; var m=String(tf).match(/^(\d+)([sm])$/i); if(!m) return 60000; var v=+m[1], u=m[2].toLowerCase(); return u==='s'? v*1000 : v*60000; }
    function cacheKey(cfg){ return cfg.broker+'|'+cfg.pairValue+'|'+cfg.tf; }
    function loadFromStorage(key){ try{ var raw=localStorage.getItem('sig:'+key); if(!raw) return null; var obj=JSON.parse(raw); if(obj && obj.expiresAt && Date.now()<obj.expiresAt) return obj; }catch(e){} return null; }
    function saveToStorage(key,val){ try{ localStorage.setItem('sig:'+key, JSON.stringify(val)); }catch(e){} }
    function clearStorage(key){ try{ localStorage.removeItem('sig:'+key); }catch(e){} }

    function justify(ind){
      var P = I18N[currentLang].ph;
      if(ind==='MACD'){
        var macd=rnd(-2.5,2.5).toFixed(2);
        var signal=(parseFloat(macd)+rnd(-0.6,0.6)).toFixed(2);
        var cross=Math.random()<0.5? P.bull:P.bear;
        var hl=Math.random()<0.5? P.high:P.low;
        if(currentLang==='en') return 'MACD '+cross+' crossover (MACD‚âà'+macd+', Signal‚âà'+signal+'), divergence at a '+hl+'.';
        if(currentLang==='es') return 'Cruce '+cross+' de MACD (MACD‚âà'+macd+', Se√±al‚âà'+signal+'), divergencia en '+hl+'.';
        if(currentLang==='fr') return 'Croisement '+cross+' du MACD (MACD‚âà'+macd+', Signal‚âà'+signal+'), divergence sur un '+hl+'.';
        if(currentLang==='ar') return 'MACD '+cross+' (MACD‚âà'+macd+'ÿå ÿßŸÑÿ•ÿ¥ÿßÿ±ÿ©‚âà'+signal+')ÿå ÿßŸÜÿ≠ÿ±ÿßŸÅ ÿπŸÜÿØ '+hl+'.';
        return 'MACD '+cross+' –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (MACD‚âà'+macd+', Signal‚âà'+signal+'), –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º '+hl+'.';
      }
      if(ind==='STOCH'){
        var k=rndi(5,95), d=Math.min(100,Math.max(0,k+rndi(-8,8)));
        var zone = k>80? P.sto.overb : k<20? P.sto.overs : P.sto.mid;
        var extra = [P.sto.div,P.sto.cross,P.sto.exit][rndi(0,2)];
        if(currentLang==='en') return 'Stochastic %K‚âà'+k+', %D‚âà'+d+', '+zone+' zone, '+extra+'.';
        if(currentLang==='es') return 'Estoc√°stico %K‚âà'+k+', %D‚âà'+d+', zona de '+zone+', '+extra+'.';
        if(currentLang==='fr') return 'Stochastique %K‚âà'+k+', %D‚âà'+d+', zone de '+zone+', '+extra+'.';
        if(currentLang==='ar') return 'ÿ≥ÿ™ŸàŸÉÿßÿ≥ÿ™ŸäŸÉ %K‚âà'+k+'ÿå %D‚âà'+d+'ÿå ŸÖŸÜÿ∑ŸÇÿ© '+zone+'ÿå '+extra+'.';
        return 'Stochastic %K‚âà'+k+', %D‚âà'+d+', –∑–æ–Ω–∞ '+zone+', –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è '+extra+'.';
      }
      if(ind==='RSI'){
        var v=rndi(5,95);
        var zone2=v>70? P.rsi.overb : v<30? P.rsi.overs : P.rsi.bal;
        var extra2=[P.rsi.r50,P.rsi.hdiv,P.rsi.brk][rndi(0,2)];
        if(currentLang==='en') return 'RSI‚âà'+v+' ('+zone2+'), '+extra2+'.';
        if(currentLang==='es') return 'RSI‚âà'+v+' ('+zone2+'), '+extra2+'.';
        if(currentLang==='fr') return 'RSI‚âà'+v+' ('+zone2+'), '+extra2+'.';
        if(currentLang==='ar') return 'RSI‚âà'+v+' ('+zone2+')ÿå '+extra2+'.';
        return 'RSI‚âà'+v+' ('+zone2+'), '+extra2+'.';
      }
      if(ind==='WILL'){
        var vv=rndi(-100,-1);
        var zone3=vv>-20? P.will.overb : vv<-80? P.will.overs : P.will.neutral;
        var extra3=[P.will.exit,P.will.post,P.will.ret][rndi(0,2)];
        if(currentLang==='en') return 'Williams %R‚âà'+vv+' ('+zone3+'), '+extra3+'.';
        if(currentLang==='es') return 'Williams %R‚âà'+vv+' ('+zone3+'), '+extra3+'.';
        if(currentLang==='fr') return 'Williams %R‚âà'+vv+' ('+zone3+'), '+extra3+'.';
        if(currentLang==='ar') return 'Williams %R‚âà'+vv+' ('+zone3+')ÿå '+extra3+'.';
        return 'Williams %R‚âà'+vv+' ('+zone3+'), '+extra3+'.';
      }
      if(ind==='BBAN'){
        var pos=[P.bban.upper,P.bban.middle,P.bban.lower][rndi(0,2)];
        var width=rnd(1.2,3.5).toFixed(1);
        var extra4=[P.bban.squeeze,P.bban.bounce,P.bban.brk][rndi(0,2)];
        if(currentLang==='en') return 'Bollinger Bands: price near '+pos+' band, width‚âà'+width+'œÉ, '+extra4+'.';
        if(currentLang==='es') return 'Bandas de Bollinger: precio en la banda '+pos+', ancho‚âà'+width+'œÉ, '+extra4+'.';
        if(currentLang==='fr') return 'Bandes de Bollinger : prix pr√®s de la bande '+pos+', largeur‚âà'+width+'œÉ, '+extra4+'.';
        if(currentLang==='ar') return 'ÿ®ŸàŸÑŸÜÿ¨ÿ± ÿ®ÿßŸÜÿØÿ≤: ÿßŸÑÿ≥ÿπÿ± ÿπŸÜÿØ '+pos+'ÿå ÿßŸÑÿπÿ±ÿ∂‚âà'+width+'œÉÿå '+extra4+'.';
        return 'Bollinger Bands: —Ü–µ–Ω–∞ —É '+pos+' –ø–æ–ª–æ—Å—ã, —à–∏—Ä–∏–Ω–∞ –ø–æ–ª–æ—Å‚âà'+width+'œÉ, '+extra4+'.';
      }
      return '';
    }

    function getOrCreateSignal(cfg){
      var key = cacheKey(cfg), s = SIGNAL_CACHE.get(key);
      if(!s){ s = loadFromStorage(key); if(s) SIGNAL_CACHE.set(key, s); }
      if(s && Date.now() < s.expiresAt) return s;
      var ind = indicatorEl.value || 'AUTO';
      if(ind==='AUTO') ind = pick(['MACD','STOCH','RSI','WILL','BBAN']);
      var side = biasSide(), reason = justify(ind), d=new Date(), exp=Date.now()+tfToMs(cfg.tf);
      s = { side:side, ind:ind, reason:reason, ts:formatTime(d), expiresAt:exp };
      SIGNAL_CACHE.set(key, s); saveToStorage(key, s);
      return s;
    }

    function renderResult(cfg, sig){
      var L=I18N[currentLang], title=sig.side==='BUY'?L.result.buy:L.result.sell, badgeClass=sig.side==='BUY'?'buy':'sell';
      outEl.innerHTML =
        '<div class="result">'+
          '<div class="row" style="justify-content:space-between; align-items:center">'+
            '<div class="badge '+badgeClass+'">'+title+'</div>'+
            '<div class="meta"><span>'+sig.ts+'</span> ‚Ä¢ <span id="countdown">'+L.result.nextIn+' ‚Ä¶</span></div>'+
          '</div>'+
          '<div class="just">'+
            '<strong>'+cfg.broker+'</strong> ‚Ä¢ <strong>'+cfg.pairLabel+'</strong> ‚Ä¢ '+L.labels.tf+': <strong>'+cfg.tf+'</strong><br/>'+
            L.result.indicator+': <strong>'+L.indNames[sig.ind]+'</strong><br/>'+
            L.result.reason+': '+sig.reason+
          '</div>'+
        '</div>';
    }

    function currentConfig(){
      var pairLabel = pairEl.options[pairEl.selectedIndex] ? pairEl.options[pairEl.selectedIndex].text : pairEl.value + ' (OTC)';
      return { broker:brokerEl.value, pairValue:pairEl.value, pairLabel:pairLabel, tf:tfEl.value };
    }

    function setButtonsLocked(locked){
      if(locked){ startBtn.disabled=true; againBtn.disabled=true; }
      else { var ok = brokerEl.value && pairEl.value && tfEl.value; startBtn.disabled=!ok; againBtn.disabled=!lastSig; }
    }

    function formatDuration(ms){ var s=Math.max(0,Math.ceil(ms/1000)); var h=Math.floor(s/3600); s%=3600; var m=Math.floor(s/60); var ss=s%60;
      return (h? (''+h).padStart(2,'0')+':' : '') + (''+m).padStart(2,'0')+':'+(''+ss).padStart(2,'0'); }
    function stopCountdown(){ if(countdownTimer){ clearInterval(countdownTimer); countdownTimer=null; } }
    function startCountdownFor(cfg, sig){
      stopCountdown(); var L=I18N[currentLang], key=cacheKey(cfg);
      function tick(){
        var el=document.getElementById('countdown'); if(!el){ stopCountdown(); return; }
        var rem=sig.expiresAt-Date.now();
        if(rem<=0){
          el.textContent=L.result.ready;
          setButtonsLocked(false);
          SIGNAL_CACHE.delete(key); clearStorage(key);
          stopCountdown();
          return;
        }
        el.textContent=L.result.nextIn+' '+formatDuration(rem);
      }
      countdownTimer = setInterval(tick,1000); tick();
    }

    /* ===== Chart ===== */
    function resizeCanvas(){
      var dpr=Math.max(1, window.devicePixelRatio||1), r=chartEl.getBoundingClientRect();
      canvas.width=Math.floor(r.width*dpr); canvas.height=Math.floor(r.height*dpr);
      canvas.style.width=r.width+'px'; canvas.style.height=r.height+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0); drawGrid();
    }
    function drawGrid(){
      var w=canvas.width/(window.devicePixelRatio||1), h=canvas.height/(window.devicePixelRatio||1);
      ctx.save(); ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.setTransform(window.devicePixelRatio||1,0,0,window.devicePixelRatio||1,0,0);
      ctx.strokeStyle='rgba(255,255,255,.07)'; ctx.lineWidth=1; var step=28;
      for(var y=0;y<h;y+=step){ ctx.beginPath(); ctx.moveTo(0,y+.5); ctx.lineTo(w,y+.5); ctx.stroke(); }
      ctx.restore();
    }
    function genCandles(n, side){
      n=n||60; var data=[], price=rnd(90,110), drift= side==='BUY'? rnd(0.05,0.25) : -rnd(0.05,0.25);
      for(var i=0;i<n;i++){
        var vol=rnd(0.5,2.4), open=price, delta=drift+rnd(-0.6,0.6), close=Math.max(10, open+delta);
        var high=Math.max(open,close)+rnd(0.2,1.4)*vol, low=Math.min(open,close)-rnd(0.2,1.4)*vol; price=close;
        data.push({open:open,high:high,low:low,close:close});
      } return data;
    }
    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      var R=Math.min(r,w/2,h/2); ctx.beginPath();
      ctx.moveTo(x+R,y); ctx.arcTo(x+w,y,x+w,y+h,R); ctx.arcTo(x+w,y+h,x,y+h,R); ctx.arcTo(x,y+h,x,y,R); ctx.arcTo(x,y,x+w,y,R);
      if(fill) ctx.fill(); if(stroke) ctx.stroke();
    }
    function animateCandles(side){
      cancelAnimationFrame(raf); resizeCanvas();
      var up='#7ef2b3', down='#ff9ea1', olUp='#1d5e41', olDown='#6e2326';
      var data=genCandles(64,side), w=canvas.clientWidth, h=canvas.clientHeight, pad=14, visible=40, cw=Math.max(6,Math.floor((w-pad*2)/visible)), gap=2;
      var prices=[]; for(var i=0;i<data.length;i++){ prices.push(data[i].high,data[i].low); }
      var minP=Math.min.apply(null,prices), maxP=Math.max.apply(null,prices);
      function px(p){ return pad + (p-minP)/(maxP-minP+1e-6)*(h-pad*2); }
      var i=0; trendLabel.textContent = side==='BUY' ? 'BUY' : 'SELL';
      function frame(){
        drawGrid();
        var start=Math.max(0, i-visible+1);
        for(var k=start;k<=i;k++){
          var d=data[k]; if(!d) continue;
          var x=pad + (k-start)*(cw+gap);
          var openY=h-px(d.open), closeY=h-px(d.close), highY=h-px(d.high), lowY=h-px(d.low);
          var isUp=d.close>=d.open, col=isUp? up:down, ol=isUp? olUp:olDown;
          ctx.strokeStyle=col; ctx.lineWidth=1.2; ctx.beginPath(); ctx.moveTo(x+cw/2, highY); ctx.lineTo(x+cw/2, lowY); ctx.stroke();
          var bodyY=Math.min(openY,closeY), bodyH=Math.max(2, Math.abs(closeY-openY));
          ctx.fillStyle=col; ctx.strokeStyle=ol; ctx.lineWidth=1; roundRect(ctx,x+0.5, bodyY, cw-1, bodyH, 3, true, true);
        }
        // direction arrow
        var ax=w-34, ay=22; ctx.fillStyle= side==='BUY'? up:down; ctx.strokeStyle='rgba(255,255,255,.15)'; ctx.lineWidth=1; ctx.beginPath();
        if(side==='BUY'){ ctx.moveTo(ax, ay+12); ctx.lineTo(ax+10, ay+2); ctx.lineTo(ax+20, ay+12); }
        else { ctx.moveTo(ax, ay+2); ctx.lineTo(ax+10, ay+12); ctx.lineTo(ax+20, ay+2); }
        ctx.closePath(); ctx.fill(); ctx.stroke();

        i++; if(i<data.length-1){ raf=requestAnimationFrame(frame); }
      }
      raf=requestAnimationFrame(frame);
    }

    /* ===== Run ===== */
    function triggerRun(){
      ensureOptions();
      var L=I18N[currentLang];
      loadingTextEl.textContent=(L.loading||'ANALYZING').toUpperCase();
      loadingEl.hidden=false;
      setButtonsLocked(true);
      var delay=1000+Math.floor(Math.random()*1000); // 1‚Äì2 s
      clearTimeout(loadingTimer);
      loadingTimer=setTimeout(function(){
        try{
          lastCfg=currentConfig();
          lastSig=getOrCreateSignal(lastCfg);
          renderResult(lastCfg,lastSig);
          outEl.scrollIntoView({behavior:'smooth',block:'start'});
          animateCandles(lastSig.side);
          startCountdownFor(lastCfg,lastSig);
        } finally { loadingEl.hidden=true; }
      }, delay);
    }
    startBtn.addEventListener('click', triggerRun);
    againBtn.addEventListener('click', triggerRun);

    function handleConfigChange(){
      var cfg=currentConfig(), key=cacheKey(cfg), s= SIGNAL_CACHE.get(key) || loadFromStorage(key);
      if(s && Date.now()<s.expiresAt){
        lastCfg=cfg; lastSig=s; renderResult(cfg,s); setButtonsLocked(true); animateCandles(s.side); startCountdownFor(cfg,s);
      }else{
        lastCfg=cfg; lastSig=null; stopCountdown(); trendLabel.textContent='‚Äî'; setButtonsLocked(false); outEl.innerHTML='';
      }
    }

    /* ===== Safe init ===== */
    function ensureOptions(){
      try{
        if(!indicatorEl.options.length) applyLang(currentLang||'en');
        if(!brokerEl.options.length) initBrokers();
        if(!pairEl.options.length || !tfEl.options.length) fillByBroker();
      }catch(e){ console.error('ensureOptions error', e); }
    }
    function resizeAndInit(){
      try{
        applyLang('en');   // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —è–∑—ã–∫ ‚Äî –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
        initBrokers();
        fillByBroker();
        validateReady();
        resizeCanvas();
        handleConfigChange();
      }catch(e){ console.error('init error', e); }
    }
    if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', resizeAndInit, {once:true}); } else { resizeAndInit(); }
    window.addEventListener('pageshow', ensureOptions);
    window.addEventListener('resize', function(){ resizeCanvas(); if(lastSig) animateCandles(lastSig.side); }, {passive:true});
    ['focus','mousedown','touchstart','click'].forEach(function(ev){
      brokerEl.addEventListener(ev, ensureOptions, {passive:true});
      pairEl.addEventListener(ev, ensureOptions, {passive:true});
      tfEl.addEventListener(ev, ensureOptions, {passive:true});
      indicatorEl.addEventListener(ev, ensureOptions, {passive:true});
    });
  })();
  </script>
</body>
</html>
